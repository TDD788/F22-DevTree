#!/bin/sh

# Path to sgdisk binary
SGDISK=/system/bin/sgdisk

# Path to device block
DISK=/dev/block/mmcblk0

# Get disk code and sector size
DISKCODE=`$SGDISK --print $DISK | grep super | awk '{printf $6}'`
SECSIZE=`$SGDISK --print $DISK | grep 'sector size' | awk '{printf $4}'`

function delete_partition() {
    # Delete specified partition
    local partition_name=$1
    local partition_number=`$SGDISK --print $DISK | grep -i $partition_name | awk '{printf $1}'`
    $SGDISK --delete=$partition_number $DISK
}

function repartition() {
    local partition_name=$1
    local partition_size=$2
    # Repartition with specified size
    $SGDISK --new=0:0:+${partition_size}Mib --typecode=0:$DISKCODE --change-name=0:$partition_name $DISK
}

# Prompt user to choose partition and size
echo "Available partitions:"
echo "1. ODM"
echo "2. VENDOR"
echo "3. SYSTEM"
echo "4. PRODUCT"
echo "5. RECOVERY"
echo "6. BOOT"
echo "7. USERDATA"
echo "8. Default (Super: 6265 MB, Prism: 30 MB)"
read -p "Select partition number to repartition (1-8): " partition_number

case $partition_number in
    1)
        partition_name="ODM"
        ;;
    2)
        partition_name="VENDOR"
        ;;
    3)
        partition_name="SYSTEM"
        ;;
    4)
        partition_name="PRODUCT"
        ;;
    5)
        partition_name="RECOVERY"
        ;;
    6)
        partition_name="BOOT"
        ;;
    7)
        partition_name="USERDATA"
        ;;
    8)
        partition_name="PRISM"
        partition_size=30
        ;;
    *)
        echo "Invalid partition number selected. Exiting."
        exit 1
        ;;
esac

# If partition_name is PRISM and size is not set by user, set default size to 30 MB
if [ "$partition_name" == "PRISM" ] && [ -z "$partition_size" ]; then
    partition_size=30
fi

# Main
delete_partition $partition_name
repartition $partition_name $partition_size